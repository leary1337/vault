---
создал заметку: 2024-07-24
tags:
  - golang
---
### Описание
Горутины и планировщик являются основными компонентами многопоточности в Go, обеспечивая параллельное выполнение и управление потоками. Горутины — это легковесные потоки, управляемые планировщиком Go, который эффективно распределяет их на доступные процессорные ядра.

### Горутины

Горутины (goroutines) — это функции, выполняемые одновременно с другими горутинами в той же программе. Они создаются с помощью ключевого слова `go` перед вызовом функции.

Пример создания горутины:
```go
go func() {
    fmt.Println("Hello from a goroutine")
}()
```
Горутины значительно легче по весу, чем системные потоки, и могут быть созданы в больших количествах без значительного потребления ресурсов.

### Планировщик

Планировщик Go (scheduler) управляет выполнением горутин. Он использует модель M:N, где M — это количество горутин, а N — количество системных потоков (OS threads). Планировщик распределяет горутины между потоками, что позволяет эффективно использовать ресурсы процессора.

Основные компоненты планировщика:
- **G (goroutine)**: представляет собой горутину, включая её стек и контекст выполнения.
- **M (machine)**: представляет системный поток, который выполняет горутины.
- **P (processor)**: абстракция, которая контролирует выполнение горутин на определенном потоке.

Планировщик управляет состояниями горутин, такими как готовность к выполнению, выполнение и ожидание. Он также обрабатывает приостановку и возобновление горутин, переключение контекста и балансировку нагрузки.

### Взаимодействие горутин

Горутины взаимодействуют друг с другом с помощью каналов и других механизмов синхронизации, таких как мьютексы (mutexes) и атомарные операции. Это помогает избежать гонок данных и обеспечивает безопасный доступ к общим ресурсам.

Пример взаимодействия через канал:
```go
ch := make(chan int)
go func() {
    ch <- 42
}()
result := <-ch
fmt.Println(result) // Вывод: 42
```

### Планирование горутин

Планировщик Go использует кооперативное многозадачное планирование, что означает, что горутины сами уступают управление. Это достигается с помощью функции `runtime.Gosched()`, которая позволяет текущей горутине уступить планирование другим горутинам.

### Краткое содержание

Горутины и планировщик являются ключевыми компонентами многопоточности в Go, обеспечивая эффективное параллельное выполнение и управление потоками. Горутины легковесны и могут быть созданы в больших количествах, а планировщик управляет их распределением на системные потоки, обеспечивая эффективное использование процессорных ресурсов. Механизмы взаимодействия горутин, такие как каналы, помогают избежать гонок данных и обеспечивают безопасное взаимодействие между потоками.
