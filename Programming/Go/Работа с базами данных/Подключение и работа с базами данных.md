---
создал заметку: 2024-07-24
tags:
  - golang
---
### Описание
Работа с базами данных является важной частью многих приложений. Go предоставляет гибкие и эффективные инструменты для подключения к базам данных и выполнения запросов. Основным пакетом для работы с базами данных является `database/sql`, который предоставляет стандартный интерфейс для взаимодействия с различными базами данных через драйверы.

### Подключение к базе данных

Для подключения к базе данных используется функция `sql.Open`, которая возвращает объект `*sql.DB`. Этот объект используется для выполнения запросов и управления подключением.

Пример подключения к базе данных MySQL:
```go
import (
    "database/sql"
    _ "github.com/go-sql-driver/mysql"
    "log"
)

func main() {
    dsn := "user:password@tcp(127.0.0.1:3306)/dbname"
    db, err := sql.Open("mysql", dsn)
    if err != nil {
        log.Fatal(err)
    }
    defer db.Close()

    // Проверка подключения
    if err := db.Ping(); err != nil {
        log.Fatal(err)
    }
    log.Println("Connected to the database!")
}
```

### Выполнение запросов

`*sql.DB` предоставляет методы для выполнения SQL-запросов, такие как `Query` для SELECT-запросов и `Exec` для INSERT, UPDATE и DELETE.

Пример выполнения SELECT-запроса:
```go
rows, err := db.Query("SELECT id, name FROM users WHERE age > ?", 18)
if err != nil {
    log.Fatal(err)
}
defer rows.Close()

for rows.Next() {
    var id int
    var name string
    if err := rows.Scan(&id, &name); err != nil {
        log.Fatal(err)
    }
    log.Printf("User: %d, %s
", id, name)
}
```

Пример выполнения INSERT-запроса:
```go
_, err := db.Exec("INSERT INTO users(name, age) VALUES(?, ?)", "John Doe", 30)
if err != nil {
    log.Fatal(err)
}
```

### Использование транзакций

Транзакции обеспечивают атомарность и изолированность выполнения серии операций. В Go транзакции управляются с помощью методов `Begin`, `Commit` и `Rollback` объекта `*sql.DB`.

Пример использования транзакций:
```go
tx, err := db.Begin()
if err != nil {
    log.Fatal(err)
}

_, err = tx.Exec("INSERT INTO accounts(user_id, balance) VALUES(?, ?)", 1, 100)
if err != nil {
    tx.Rollback()
    log.Fatal(err)
}

err = tx.Commit()
if err != nil {
    log.Fatal(err)
}
```

### Краткое содержание

Go предоставляет мощные инструменты для работы с базами данных через пакет `database/sql`. Это включает подключение к базам данных, выполнение SQL-запросов и управление транзакциями. Правильное использование этих инструментов помогает создавать надежные и эффективные приложения с доступом к данным.
