---
создал заметку: 2024-07-27
tags:
  - golang
  - concurrency
---
### Описание
**Горутины (Goroutines)** — это легковесные потоки выполнения, которые [Go runtime](Programming/Go/Внутреннее%20устройство%20Go/Runtime.md) использует для параллельного выполнения задач. Они представляют собой продвинутую концепцию потоков, позволяющую работать с [многозадачностью и параллелизмом в Go](Programming/Go/Concurrency/Основы%20конкурентности%20в%20Go.md). В отличие от традиционных потоков операционной системы (OS), горутины значительно легче и эффективнее в управлении.
#### Определение горутины

**Горутина** — это функция или метод, который выполняется параллельно с другими горутинами в той же программе. Запуск горутины осуществляется с помощью ключевого слова `go`, что позволяет программе асинхронно выполнять код без блокировки основного потока.

Пример запуска горутины:
```go
go func() {
    fmt.Println("Hello from goroutine!")
}()
```
В этом примере горутина выполняет анонимную функцию, печатающую сообщение в консоль. Основной поток программы продолжает своё выполнение параллельно с этой горутиной.
#### Отличия горутин от потоков ОС

1. **Управление и планирование**:
	Горутины управляются не операционной системой, а [Go runtime](Programming/Go/Внутреннее%20устройство%20Go/Runtime.md). Это означает, что Go runtime включает свой собственный **планировщик**, который распределяет выполнение горутин между доступными процессорными ядрами. В отличие от потоков ОС, которые требуют взаимодействия с ядром системы для управления и переключения контекста, *горутины управляются в пространстве пользователя*, что значительно снижает накладные расходы.

2. **Размер стека**:
	Горутины начинаются с минимального стека размером **2-4 КБ**, который может динамически расширяться по мере необходимости. В противоположность этому, потоки ОС обычно имеют фиксированный стек размером несколько мегабайт, что увеличивает потребление памяти.

3. **Изолированность от ОС**:
	Горутины не зависят от особенностей базовой операционной системы. Они работают в виртуальном пространстве Go runtime, что делает их переносимыми и независимыми от платформы. Это также упрощает реализацию оптимизаций, так как *они контролируются Go runtime, а не ОС*.

4. **Масштабируемость и производительность**:
	Горутины могут быть созданы в гораздо большем количестве, чем потоки ОС, без значительного влияния на производительность. Go runtime оптимизирует использование ресурсов и минимизирует накладные расходы на создание и переключение горутин.

#### Почему горутины легковесны?

Легковесность горутин обусловлена несколькими ключевыми факторами:
1. **Минимальный начальный размер стека**:
	Начальный стек горутины составляет всего 2-4 КБ, что значительно меньше, чем у потоков ОС. Это позволяет создавать тысячи горутин без значительного увеличения потребления памяти. При необходимости, если горутине требуется больше памяти, её стек может динамически расширяться.

2. **Динамическое управление стеком**:
	В отличие от потоков ОС, которые имеют фиксированный размер стека, горутины могут динамически изменять размер своего стека. Это позволяет эффективно использовать память и избегать избыточного резервирования ресурсов.

3. **Упрощённое переключение контекста**:
	Поскольку горутины управляются Go runtime, переключение контекста между ними выполняется на уровне пользователя, без вовлечения ядра операционной системы. Это значительно снижает накладные расходы на переключение контекста и повышает общую производительность.

4. **Низкая задержка и быстрое время запуска**:
	Горутины запускаются почти мгновенно и с минимальными затратами, что делает их идеальными для задач, требующих параллелизма и быстрой реакции на события.

#### Что хранит горутина?

Горутина хранит минимально необходимую информацию для выполнения своих задач:
1. **Стек горутины**:
	Содержит локальные переменные, параметры функции и другую контекстную информацию. Стек может динамически изменяться по мере выполнения горутины.

2. **Состояние выполнения**:
	Включает информацию о текущем состоянии выполнения, такую как указатели на текущую инструкцию, регистры и состояние синхронизации.

3. **Ссылки на объекты и данные**:
	Горутины могут иметь ссылки на объекты, данные и функции, которые они используют в процессе выполнения.

4. **Контекст синхронизации**:
	Если горутина взаимодействует с другими горутинами через каналы или другие механизмы синхронизации, она хранит соответствующий контекст, необходимый для корректного взаимодействия.
### Краткое содержание

**Горутины (Goroutines)** — это легковесные потоки выполнения, которые [Go runtime](Programming/Go/Внутреннее%20устройство%20Go/Runtime.md) использует для параллельного выполнения задач. Они представляют собой продвинутую концепцию потоков, позволяющую работать с [многозадачностью и параллелизмом в Go](Programming/Go/Concurrency/Основы%20конкурентности%20в%20Go.md). В отличие от традиционных потоков операционной системы (OS), горутины значительно легче и эффективнее в управлении. ^bacf49

